var MICROSTOCKS=function(){var t=function(t){for(var o="",e=0;e<t.length;e++)o=o+'{"name":"'+t[e].name+'","cost":'+t[e].cost+',"amount":'+t[e].amount+"},";return o=o.slice(0,-1)},o=function(t,o){return(void 0===t||NaN===t||null===t||"number"!=typeof t)&&(t=1,o=100),(void 0===o||NaN===o||null===o||"number"!=typeof o)&&(o=t,t=1),Math.floor(Math.random()*(o-t)+t)},e=function(){for(var t="",e=0;3>e;e++)t+=String.fromCharCode(65+o(26));return t},s=function(t){for(var s=[],n=0;t>n;n++)s.push({cost:o(o(2,5),o(20,o(20,110))),name:e()});return s},n=function(t,e){for(var s=0;e>s;s++){var n=!1;o(100)>70?(t[s].amount=o(o(1,4),o(5,20)),n=!0):t[s].amount=0}n===!1&&(t[o(0,t.length)].amount=o(o(1,4),o(5,20)))},a={};document.getElementsByClassName("log")[0];logList=document.getElementsByClassName("log-list")[0],moveFee=10,stockAmount=o(12,20),stocks=s(stockAmount),n(stocks,stockAmount),stocks.sort(function(t,o){return o.amount-t.amount}),locations=["New York","Chicago","Philadelphia","Austin","Los Angeles","San Fransisco","Seattle","Portland","Minneapolis","Cleveland","Providence"],playerString='{"stats":{"money":'+o(500)+',"location":"'+o(locations.length)+'","stocks":['+t(stocks)+"]}}",playerObject=JSON.parse(playerString);var l=function(t,o,e){if(void 0!==o&&null!==o)for(var s="object"==typeof o?o.length:1,n="",a=0;s>a;a++){n="function"==typeof o[0]?o[0](o[1],o[2]):"object"==typeof o?o[a]:o;var l=document.createElement("LI"),c=document.createTextNode(n);l.appendChild(c),void 0!==t||null!==t?(t.appendChild(l),t.scrollTop=t.scrollHeight):console.error("addListElement exception: obj was null. Please call addListELement with a non-null, defined object as the first argument. See syntax: addListElement(obj, text, cssClass), with cssClass being optional.")}else console.error("addListElement exception: text was null. Please call addListELement with a non-null, defined text string as the second argument. See syntax: addListElement(obj, text, cssClass), with cssClass being optional.");if(void 0!==e&&null!==e){var r=e.split(" ");for(var a in r)l.classList.add(r[a])}},c=function(t,o){var e=document.getElementsByClassName(t)[0];void 0!==e?e.innerText=o:console.error("changeListElement needs to be called with a valid cssClass and incoming text. Check your syntax: changeListElement(cssClass, text);")},r=function(){for(var t=playerObject.stats.stocks,e=0,s=250,n=0,a="",c=0;c<t.length;c++)e=0,n=t[c].cost,a=t[c].name,o(100)<18?o(100)<o(30,48)?(e=o(5),l(logList,a+" has risen $"+e+" dollars.","stock-increase")):o(100)<o(30,48)&&n>0&&(e=-1*o(5),l(logList,a+" has fallen $"+Math.abs(e)+" dollars.","stock-decrease")):o(1e3)<5?(e=Math.floor(n*(.01*o(1,20))),l(logList,a+" has risen $"+e+" dollars.","stock-increase")):o(1e3)<5&&n>0&&(e=-1*Math.floor(n*(.01*o(1,20))),l(logList,a+" has fallen $"+Math.abs(e)+" dollars.","stock-decrease")),playerObject.stats.stocks[c].cost=parseInt(n)+e,1>=n&&o(100)<25&&(playerObject.stats.stocks[c].cost=o(5,11)),parseInt(n)>=s&&(o(100)<33?playerObject.stats.stocks[c].cost=n*(.01*o(55,70)):playerObject.stats.stocks[c].cost=s)},i=function(){var t=playerObject.stats;r(),c("cash","Money: $"+t.money);for(var o=0,e=0;e<t.stocks.length;e++)o+=t.stocks[e].amount*t.stocks[e].cost;c("portfolio","Total Portfolio: $"+o);var s=document.getElementsByClassName("net-worth")[0],n=s.textContent;n=n.split("$"),parseInt(n[1])<o+parseInt(t.money)?c("net-worth","Net Worth: $"+(o+parseInt(t.money))+" --- Up!"):parseInt(n[1])===o+parseInt(t.money)?c("net-worth","Net Worth: $"+(o+parseInt(t.money))):c("net-worth","Net Worth: $"+(o+parseInt(t.money))+" --- Down!"),c("location","Location: "+locations[t.location]),t.stocks.sort(function(t,o){return o.amount-t.amount});for(var e=0;e<t.stocks.length;e++){var a=document.getElementsByClassName("stocks-"+e)[0];c("stocks-"+e,t.stocks[e].name+" | "+t.stocks[e].amount+" owned | $"+t.stocks[e].cost),t.stocks[e].amount>0&&!a.classList.contains("owned")?a.classList.add("owned"):0===t.stocks[e].amount&&a.classList.contains("owned")&&a.classList.remove("owned")}},u=function(){for(var t=[],o=0;o<playerObject.stats.stocks.length;o++)playerObject.stats.stocks[o].amount>0&&t.push(o);return 0!==t.length?!0:!1},d=function(){var t=[];if(playerObject.stats.stocks.length>1)for(var e=0;e<playerObject.stats.stocks.length;e++)playerObject.stats.stocks[e].amount>0&&t.push(e);playerObject.stats.stockIndex=0===t.length?0:t[o(0,t.length)]},m=function(t){var e=playerObject.stats;"undefined"!=typeof t&&"object"!=typeof t?t<e.stocks.length?playerObject.stats.stockIndex=t:console.error("updateStockIndex exception: Incoming stockIndex outside of bounds of stocks array."):playerObject.stats.stockIndex=o(0,e.stocks.length)},y=function(t){playerObject.stats.location=t},f=function(t,o,e){var s="";void 0!==t&&null!==t?t.addEventListener("click",function(){"object"==typeof o&&void 0!==o&&null!==o?o.length>1?2===o.length?s=o[0](o[1]):3===o.length&&(s=o[0](o[1],o[2])):s=o():"function"==typeof o?s=o():(console.error("addButtonEvent called with undefined logMessage function. logMessage function should return a string. See syntax: addButtonEvent(button, logFunction, moreBehavior), with moreBehavior being an optional function."),console.error("typeof logMessage = "+typeof o)),void 0!==s&&l(logList,s),void 0!==e&&null!==e&&("function"==typeof e?e():"object"==typeof e&&e[0](e[1]))}):console.error("addButtonEvent needs a defined, non-null button as it's first argument. See syntax: addButtonEvent(button, logFunction, moreBehavior), with moreBehavior being an optional function.")},p=function(t,o){"undefined"==typeof t||null===t?(m(),t=playerObject.stats.stockIndex):m(t);var e=void 0===o?1:o;return playerObject.stats.money<playerObject.stats.stocks[t].cost*e?["Can't afford share(s) of "+playerObject.stats.stocks[t].name+".","(Attempted to purchase "+e+".)"]:"You bought "+e+" share(s) of "+playerObject.stats.stocks[t].name+"."},g=function(t){var o=playerObject.stats,e=void 0===t?1:t,s=o.stockIndex;o.money>=o.stocks[s].cost*e?(playerObject.stats.money=o.money-o.stocks[s].cost*e,playerObject.stats.stocks[s].amount+=parseInt(e)):console.error("buyAction exception: Not enough money to make purchase."),i()},h=function(t,o){if("undefined"==typeof t||null===t){if(!u())return"You don't have any stock to sell! Try buying some.";d(),t=playerObject.stats.stockIndex}else m(t);var e=void 0===o?1:o;return playerObject.stats.stocks[t].amount>=e?"You sold "+e+" share(s) of "+playerObject.stats.stocks[t].name+".":"You don't have "+e+" share(s) of "+playerObject.stats.stocks[t].name+"."},k=function(t){if(u()){var o=playerObject.stats,e=void 0===t?1:t,s=o.stockIndex;o.stocks[s].amount>=e&&(playerObject.stats.stocks[s].amount-=parseInt(e),playerObject.stats.money=o.money+o.stocks[s].cost*e,i())}},v=function(){var t=playerObject.stats;if(t.money<moveFee)return"Can't afford to move! Why don't you sell some stock?";m();for(var e=o(locations.length);e===t.location;)e=o(locations.length);return y(e),["Player moved to "+locations[t.location],"Charged $"+moveFee+" to go!"]},b=function(){var t=playerObject.stats;t.money>=moveFee&&(playerObject.stats.money=parseInt(t.money)-moveFee,i())},j=function(){$(".options-text").text("Microstocks"),$(".options-subtext").text("Version 1.0.5"),$(".options-author").html('Author: <a href="https://github.com/evangipson">Evan Gipson</a>'),$(".options").dialog({modal:!0,buttons:{Close:function(){$(this).dialog("close")}}})},O=function(t){var o=playerObject.stats,e=0,s=0,n=0,a=1,c=o.stocks[t].name;$(".buy-sell-dialogue").text("Would you like to buy or sell "+c+" stock today?"),$(".buy-sell").dialog({modal:!0,buttons:{Buy:function(){e=parseInt(o.money)/parseInt(o.stocks[t].cost),1>e?$(".buy-sell-dialogue").text("Can't afford any "+c+" stock!"):(s=e>=50?5:1,$(".buy-stock-slider").slider({value:1,min:1,max:e,step:s,slide:function(t,o){$(".buy-stock-amount").text("Buying "+o.value+" "+c+" stock!"),a=o.value}}),n=$(".stock-slider").slider("value"),$(".buy-stock-amount").text("Buying 1 "+c+" stock!"),$(".buy-dialog").dialog("open"))},Sell:function(){o.stocks[t].amount>0?(s=o.stocks[t].amount>=50?5:1,$(".sell-stock-slider").slider({value:1,min:1,max:o.stocks[t].amount,step:s,slide:function(t,o){$(".sell-stock-amount").text("Selling "+o.value+" "+c+" stock."),a=o.value}}),n=$(".stock-slider").slider("value"),$(".sell-stock-amount").text("Selling 1 "+c+" stock."),$(".sell-dialog").dialog("open")):$(".buy-sell-dialogue").text("You don't have any "+c+" to sell!")},Cancel:function(){$(this).dialog("close")}}}),$(".buy-dialog").dialog({autoOpen:!1,modal:!0,buttons:{Buy:function(){if(null!==a&&void 0!==a){var o=p(t,a);l(logList,o),g(a)}else console.error("buySellDialogue exception: Stock purchase amount undefined or null, please try again!");$(".buy-sell").dialog("close"),$(this).dialog("close")},Cancel:function(){$(".buy-sell").dialog("close"),$(this).dialog("close")}}}),$(".sell-dialog").dialog({autoOpen:!1,modal:!0,buttons:{Sell:function(){if(null!==a&&void 0!==a){var o=h(t,a);l(logList,o),k(a)}else console.error("buySellDialogue exception: Stock sell amount undefined or null, please try again!");$(".buy-sell").dialog("close"),$(this).dialog("close")},Cancel:function(){$(".buy-sell").dialog("close"),$(this).dialog("close")}}})},x=function(){for(var t=document.getElementsByClassName("stock"),o=0;o<t.length;o++)f(t[o],[O,o])},C=function(){var t=playerObject.stats,o=document.getElementsByClassName("inventory-list")[0],e=document.getElementsByClassName("stock-list")[0],s="";l(o,"Cash: $"+t.money,"money cash");for(var n=0,a=0;a<t.stocks.length;a++)n+=t.stocks[a].amount*t.stocks[a].cost;l(o,"Total Portfolio: $"+n,"money portfolio"),l(o,"Net Worth: $"+(n+parseInt(t.money)),"money net-worth"),l(o,"Location: "+locations[t.location],"location");for(var a=0;a<stocks.length;a++)s="stock stocks-"+a+" under-hover",t.stocks[a].amount>0&&(s+=" owned"),l(e,t.stocks[a].name+" | "+t.stocks[a].amount+" owned | $"+t.stocks[a].cost,s);x()};return a.init=function(){var t=document.getElementsByClassName("buy-button")[0],o=document.getElementsByClassName("sell-button")[0],e=document.getElementsByClassName("travel-button")[0],s=document.getElementsByClassName("options-button")[0];f(t,p,g),f(o,h,k),f(e,v,b),f(s,j),C()},a}();$(document).ready(function(){MICROSTOCKS.init()});
var MICROSTOCKS=function(){var e=function(e){for(var o="",t=0;t<e.length;t++)o=o+'{"name":"'+e[t].name+'","cost":'+e[t].cost+',"amount":'+e[t].amount+"},";return o=o.slice(0,-1)},o=function(e,o){return(void 0===e||NaN===e||null===e||"number"!=typeof e)&&(e=1,o=100),(void 0===o||NaN===o||null===o||"number"!=typeof o)&&(o=e,e=1),Math.floor(Math.random()*(o-e)+e)},t=function(){for(var e="",t=0;3>t;t++)e+=String.fromCharCode(65+o(26));return e},s=function(e){for(var s=[],n=0;e>n;n++)s.push({cost:o(o(2,5),o(20,o(20,110))),name:t()});return s},n=function(e,t){for(var s=0;t>s;s++){var n=!1;o(100)>70?(e[s].amount=o(o(1,4),o(5,20)),n=!0):e[s].amount=0}n===!1&&(e[o(0,e.length)].amount=o(o(1,4),o(5,20)))},r={};document.getElementsByClassName("log")[0];logList=document.getElementsByClassName("log-list")[0],moveFee=10,resourceAmount=o(12,20),resources=s(resourceAmount),n(resources,resourceAmount),resources.sort(function(e,o){return o.amount-e.amount}),locations=["New York","Chicago","Philadelphia","Austin","Los Angeles","San Fransisco","Seattle","Portland","Minneapolis","Cleveland","Providence"],playerString='{"stats":{"money":'+o(500)+',"location":"'+o(locations.length)+'","resources":['+e(resources)+"]}}",playerObject=JSON.parse(playerString);var a=function(e,o,t){if(void 0!==o&&null!==o)for(var s="object"==typeof o?o.length:1,n="",r=0;s>r;r++){n="function"==typeof o[0]?o[0](o[1],o[2]):"object"==typeof o?o[r]:o;var a=document.createElement("LI"),l=document.createTextNode(n);a.appendChild(l),void 0!==e||null!==e?(e.appendChild(a),e.scrollTop=e.scrollHeight):console.error("addListElement exception: obj was null. Please call addListELement with a non-null, defined object as the first argument. See syntax: addListElement(obj, text, cssClass), with cssClass being optional.")}else console.error("addListElement exception: text was null. Please call addListELement with a non-null, defined text string as the second argument. See syntax: addListElement(obj, text, cssClass), with cssClass being optional.");if(void 0!==t&&null!==t){var u=t.split(" ");for(var r in u)a.classList.add(u[r])}},l=function(e,o){var t=document.getElementsByClassName(e)[0];void 0!==t?t.innerText=o:console.error("changeListElement needs to be called with a valid cssClass and incoming text. Check your syntax: changeListElement(cssClass, text);")},u=function(){for(var e=playerObject.stats.resources,t=0,s=250,n=0,r="",l=0;l<e.length;l++)t=0,n=e[l].cost,r=e[l].name,o(100)<18?o(100)<o(30,48)?(t=o(5),a(logList,r+" has risen $"+t+" dollars.","resource-increase")):o(100)<o(30,48)&&n>0&&(t=-1*o(5),a(logList,r+" has fallen $"+Math.abs(t)+" dollars.","resource-decrease")):o(1e3)<5?(t=Math.floor(n*(.01*o(1,20))),a(logList,r+" has risen $"+t+" dollars.","resource-increase")):o(1e3)<5&&n>0&&(t=-1*Math.floor(n*(.01*o(1,20))),a(logList,r+" has fallen $"+Math.abs(t)+" dollars.","resource-decrease")),playerObject.stats.resources[l].cost=parseInt(n)+t,1>=n&&o(100)<25&&(playerObject.stats.resources[l].cost=o(5,11)),parseInt(n)>=s&&(o(100)<33?playerObject.stats.resources[l].cost=n*(.01*o(55,70)):playerObject.stats.resources[l].cost=s)},c=function(){var e=playerObject.stats;u(),l("cash","Money: $"+e.money);for(var o=0,t=0;t<e.resources.length;t++)o+=e.resources[t].amount*e.resources[t].cost;l("portfolio","Total Portfolio: $"+o);var s=document.getElementsByClassName("net-worth")[0],n=s.textContent;n=n.split("$"),parseInt(n[1])<o+parseInt(e.money)?l("net-worth","Net Worth: $"+(o+parseInt(e.money))+" --- Up!"):parseInt(n[1])===o+parseInt(e.money)?l("net-worth","Net Worth: $"+(o+parseInt(e.money))):l("net-worth","Net Worth: $"+(o+parseInt(e.money))+" --- Down!"),l("location","Location: "+locations[e.location]),e.resources.sort(function(e,o){return o.amount-e.amount});for(var t=0;t<e.resources.length;t++){var r=document.getElementsByClassName("resource-"+t)[0];l("resource-"+t,e.resources[t].name+" | "+e.resources[t].amount+" owned | $"+e.resources[t].cost),e.resources[t].amount>0&&!r.classList.contains("owned")?r.classList.add("owned"):0===e.resources[t].amount&&r.classList.contains("owned")&&r.classList.remove("owned")}},i=function(){for(var e=[],o=0;o<playerObject.stats.resources.length;o++)playerObject.stats.resources[o].amount>0&&e.push(o);return 0!==e.length?!0:!1},d=function(){var e=[];if(playerObject.stats.resources.length>1)for(var t=0;t<playerObject.stats.resources.length;t++)playerObject.stats.resources[t].amount>0&&e.push(t);playerObject.stats.resourceIndex=0===e.length?0:e[o(0,e.length)]},m=function(e){var t=playerObject.stats;"undefined"!=typeof e&&"object"!=typeof e?e<t.resources.length?playerObject.stats.resourceIndex=e:console.error("updateResourceIndex exception: Incoming resourceIndex outside of bounds of resources array."):playerObject.stats.resourceIndex=o(0,t.resources.length)},y=function(e){playerObject.stats.location=e},f=function(e,o,t){var s="";void 0!==e&&null!==e?e.addEventListener("click",function(){"object"==typeof o&&void 0!==o&&null!==o?o.length>1?2===o.length?s=o[0](o[1]):3===o.length&&(s=o[0](o[1],o[2])):s=o():"function"==typeof o?s=o():(console.error("addButtonEvent called with undefined logMessage function. logMessage function should return a string. See syntax: addButtonEvent(button, logFunction, moreBehavior), with moreBehavior being an optional function."),console.error("typeof logMessage = "+typeof o)),void 0!==s&&a(logList,s),void 0!==t&&null!==t&&("function"==typeof t?t():"object"==typeof t&&t[0](t[1]))}):console.error("addButtonEvent needs a defined, non-null button as it's first argument. See syntax: addButtonEvent(button, logFunction, moreBehavior), with moreBehavior being an optional function.")},p=function(e,o){"undefined"==typeof e||null===e?(m(),e=playerObject.stats.resourceIndex):m(e);var t=void 0===o?1:o;return playerObject.stats.money<playerObject.stats.resources[e].cost*t?["Can't afford share(s) of "+playerObject.stats.resources[e].name+".","(Attempted to purchase "+t+".)"]:"You bought "+t+" share(s) of "+playerObject.stats.resources[e].name+"."},g=function(e){var o=playerObject.stats,t=void 0===e?1:e,s=o.resourceIndex;o.money>=o.resources[s].cost*t?(playerObject.stats.money=o.money-o.resources[s].cost*t,playerObject.stats.resources[s].amount+=parseInt(t)):console.error("buyAction exception: Not enough money to make purchase."),c()},h=function(e,o){if("undefined"==typeof e||null===e){if(!i())return"You don't have any resource to sell! Try buying some.";d(),e=playerObject.stats.resourceIndex}else m(e);var t=void 0===o?1:o;return playerObject.stats.resources[e].amount>=t?"You sold "+t+" share(s) of "+playerObject.stats.resources[e].name+".":"You don't have "+t+" share(s) of "+playerObject.stats.resources[e].name+"."},v=function(e){if(i()){var o=playerObject.stats,t=void 0===e?1:e,s=o.resourceIndex;o.resources[s].amount>=t&&(playerObject.stats.resources[s].amount-=parseInt(t),playerObject.stats.money=o.money+o.resources[s].cost*t,c())}},b=function(){var e=playerObject.stats;if(e.money<moveFee)return"Can't afford to move! Why don't you sell some resources?";updateResourcendex();for(var t=o(locations.length);t===e.location;)t=o(locations.length);return y(t),["Player moved to "+locations[e.location],"Charged $"+moveFee+" to go!"]},j=function(){var e=playerObject.stats;e.money>=moveFee&&(playerObject.stats.money=parseInt(e.money)-moveFee,c())},O=function(){$(".options-text").text("Microstocks"),$(".options-subtext").text("Version 1.0.5"),$(".options-author").html('Author: <a href="https://github.com/evangipson">Evan Gipson</a>'),$(".options").dialog({modal:!0,buttons:{Close:function(){$(this).dialog("close")}}})},x=function(e){var o=playerObject.stats,t=0,s=0,n=0,r=1,l=o.resources[e].name;$(".buy-sell-dialogue").text("Would you like to buy or sell "+l+" today?"),$(".buy-sell").dialog({modal:!0,buttons:{Buy:function(){t=parseInt(o.money)/parseInt(o.resources[e].cost),1>t?$(".buy-sell-dialogue").text("Can't afford any "+l+"!"):(s=t>=50?5:1,$(".buy-resource-slider").slider({value:1,min:1,max:t,step:s,slide:function(e,o){$(".buy-resource-amount").text("Buying "+o.value+" "+l+"!"),r=o.value}}),n=$(".resource-slider").slider("value"),$(".buy-resource-amount").text("Buying 1 "+l+"!"),$(".buy-dialog").dialog("open"))},Sell:function(){o.resources[e].amount>0?(s=o.resources[e].amount>=50?5:1,$(".sell-resource-slider").slider({value:1,min:1,max:o.resources[e].amount,step:s,slide:function(e,o){$(".sell-resource-amount").text("Selling "+o.value+" "+l+"."),r=o.value}}),n=$(".resource-slider").slider("value"),$(".sell-resource-amount").text("Selling 1 "+l+"."),$(".sell-dialog").dialog("open")):$(".buy-sell-dialogue").text("You don't have any "+l+" to sell!")},Cancel:function(){$(this).dialog("close")}}}),$(".buy-dialog").dialog({autoOpen:!1,modal:!0,buttons:{Buy:function(){if(null!==r&&void 0!==r){var o=p(e,r);a(logList,o),g(r)}else console.error("buySellDialogue exception: Resource purchase amount undefined or null, please try again!");$(".buy-sell").dialog("close"),$(this).dialog("close")},Cancel:function(){$(".buy-sell").dialog("close"),$(this).dialog("close")}}}),$(".sell-dialog").dialog({autoOpen:!1,modal:!0,buttons:{Sell:function(){if(null!==r&&void 0!==r){var o=h(e,r);a(logList,o),v(r)}else console.error("buySellDialogue exception: Resource sell amount undefined or null, please try again!");$(".buy-sell").dialog("close"),$(this).dialog("close")},Cancel:function(){$(".buy-sell").dialog("close"),$(this).dialog("close")}}})},C=function(){for(var e=document.getElementsByClassName("resource"),o=0;o<e.length;o++)f(e[o],[x,o])},I=function(){var e=playerObject.stats,o=document.getElementsByClassName("inventory-list")[0],t=document.getElementsByClassName("resource-list")[0],s="";a(o,"Cash: $"+e.money,"money cash");for(var n=0,r=0;r<e.resources.length;r++)n+=e.resources[r].amount*e.resources[r].cost;a(o,"Total Portfolio: $"+n,"money portfolio"),a(o,"Net Worth: $"+(n+parseInt(e.money)),"money net-worth"),a(o,"Location: "+locations[e.location],"location");for(var r=0;r<resources.length;r++)s="resource resource-"+r+" under-hover",e.resources[r].amount>0&&(s+=" owned"),a(t,e.resources[r].name+" | "+e.resources[r].amount+" owned | $"+e.resources[r].cost,s);C()};return r.init=function(){var e=document.getElementsByClassName("buy-button")[0],o=document.getElementsByClassName("sell-button")[0],t=document.getElementsByClassName("travel-button")[0],s=document.getElementsByClassName("options-button")[0];f(e,p,g),f(o,h,v),f(t,b,j),f(s,O),I()},r}();$(document).ready(function(){MICROSTOCKS.init()});
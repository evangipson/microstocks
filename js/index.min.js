var MICROSTOCKS=function(){var e=function(e,t){return(void 0===e||isNaN(e)||null===e||"number"!=typeof e)&&(e=1,t=100),(void 0===t||isNaN(t)||null===t||"number"!=typeof t)&&(t=e,e=1),Math.floor(Math.random()*(t-e)+e)},t=function(){for(var t="",o=0;3>o;o++)t+=String.fromCharCode(65+e(26));return t},o=function(){var t=[{name:"Health",icon:"fa-heartbeat"},{name:"Natural",icon:"fa-paw"},{name:"Tech",icon:"fa-qrcode"},{name:"Rare",icon:"fa-diamond"},{name:"Mineral",icon:"fa-gg-circle"}];return t[e(0,t.length)]},s=function(t){var o="",s=[{name:"stable-up",maxFlux:e(0,3)},{name:"stable",maxFlux:e(-1,2)},{name:"stable-down",maxFlux:e(-2,0)}],n=[{name:"volatile-up",maxFlux:e(0,6)},{name:"volatile",maxFlux:e(-3,4)},{name:"volatile-down",maxFlux:e(-5,-1)}];return o="Health"==t.name||"Natural"==t.name?s[0]:"Mineral"==t.name?s[e(0,s.length)]:n[e(0,n.length)]},n=function(n){for(var a=[],r="",l=0;n>l;l++)a[l]={},r=o(),a[l].cost=e(e(2,5),e(20,e(20,110))),a[l].name=t(),a[l].type=r,a[l].trend=s(r);return a},a=function(t,o){for(var s=!1,n=0;o>n;n++)e(100)>70?(t[n].amount=e(e(1,4),e(5,20)),s=!0):t[n].amount=0;s===!1&&(t[e(0,t.length)].amount=e(e(1,4),e(5,20)))},r={},l=document.getElementsByClassName("log-list")[0],u=10,c=e(12,20),i=n(c);a(i,c),i.sort(function(e,t){return t.amount-e.amount});for(var d=["New York","Chicago","Philadelphia","Austin","Los Angeles","San Fransisco","Seattle","Portland","Minneapolis","Cleveland","Providence"],m={stats:{money:e(350,500),location:e(d.length),resources:i}},f=0,h=0;h<m.stats.resources.length;h++)f+=m.stats.resources[h].amount*m.stats.resources[h].cost;google.charts.load("current",{packages:["corechart"]});var p=new Date,g=p.getMonth()+1,y=p.getFullYear(),v={cash:[],netWorth:[],portfolio:[],resourceAmounts:[],totalMoney:[]};v.cash.push(["Date","Cash"]),v.cash.push([y+"-"+g,m.stats.money]),v.portfolio.push(["Date","Cash"]),v.portfolio.push([y+"-"+g,f]),v.netWorth.push(["Date","Cash"]),v.netWorth.push([y+"-"+g,f+m.stats.money]),v.totalMoney.push(["Date","Cash","Portfolio","Net Worth"]),v.totalMoney.push([y+"-"+g,m.stats.money,f,f+m.stats.money]);var b=function(e,t,o){var s="";if(void 0!==t&&null!==t){var n="";n=t,s=document.createElement("LI");var a=document.createTextNode(n);s.appendChild(a),void 0!==e||null!==e?(e.appendChild(s),e.scrollTop=e.scrollHeight):console.error("addListElement exception: obj was null. Please call addListELement with a non-null, defined object as the first argument. See syntax: addListElement(obj, text, cssClass), with cssClass being optional.")}if(void 0!==o&&null!==o)if(o.split(" ").length>1){var r=o.split(" ");for(var l in r)r.hasOwnProperty(l)&&s.classList.add(r[l])}else s.classList.add(o)},x=function(e,t){var o=document.getElementsByClassName(e)[0];void 0!==o?o.innerText=t:console.error("changeListElement needs to be called with a valid cssClass and incoming text. Check your syntax: changeListElement(cssClass, text);")},C=function(t,o,s,n,a){e(100)<60&&(t[a].cost<o&&t[a].cost>1?(m.stats.resources[a].cost+=s,s>0?b(l,n+" has risen $"+s+" dollars.","resource-increase"):s>0&&b(l,n+" has fallen $"+Math.abs(s)+" dollars.","resource-decrease")):t[a].cost<1&&(m.stats.resources[a].cost=1,b(l,n+" bottomed out! Worth $1.","resource-decrease")))},w=function(t,o,s,n,a){e(100)<30&&(t[a].cost<o&&t[a].cost>1?(m.stats.resources[a].cost+=s,s>0?b(l,n+" has risen $"+s+" dollars.","resource-increase"):s>0&&b(l,n+" has fallen $"+Math.abs(s)+" dollars.","resource-decrease")):t[a].cost<1&&(m.stats.resources[a].cost=1,b(l,n+" bottomed out! Worth $1.","resource-decrease")))},E=function(){for(var t=m.stats.resources,o="",s="",n=0,a=250,r=0;r<t.length;r++)n=e(0,t[r].trend.maxFlux),o=t[r].name,s=t[r].trend.name,"stable-up"===s||"stable"===s||"stable-down"===s?w(t,a,n,o,r):C(t,a,n,o,r)},I=function(){var e=m.stats;e.resources.sort(function(e,t){return t.amount-e.amount});for(var t="",o="",s=0;s<e.resources.length;s++)t=document.getElementsByClassName("resource-"+s)[0],o='<p><span class="fa '+e.resources[s].type.icon+' fa-fw"></span>'+e.resources[s].name+'</p><p><span class="fa fa-dollar fa-fw"></span>'+e.resources[s].cost+"</p>",e.resources[s].amount>0&&(o+='<p><span class="fa fa-shopping-cart fa-fw"></span>'+e.resources[s].amount+"</p>"),t.innerHTML=o,e.resources[s].amount>0&&!t.classList.contains("owned")?t.classList.add("owned"):0===e.resources[s].amount&&t.classList.contains("owned")&&t.classList.remove("owned")},N=function(){var e=m.stats;v.cash.push([y+"-"+g,e.money]),v.portfolio.push([y+"-"+g,f]),v.netWorth.push([y+"-"+g,f+e.money]),v.totalMoney.push([y+"-"+g,e.money,f,f+e.money])},B=function(){g>=12?(g=1,y+=1):g+=1,N()},M=function(){var e=m.stats;E(),x("cash-button","Money: $"+e.money),f=0;for(var t=0;t<e.resources.length;t++)f+=e.resources[t].amount*e.resources[t].cost;x("portfolio-button","Total Portfolio: $"+f);var o=document.getElementsByClassName("net-worth-button")[0],s=o.textContent;s=s.split("$"),parseInt(s[1])<f+parseInt(e.money)?x("net-worth-button","Net Worth: $"+(f+parseInt(e.money))+" --- Up!"):parseInt(s[1])===f+parseInt(e.money)?x("net-worth-button","Net Worth: $"+(f+parseInt(e.money))):x("net-worth-button","Net Worth: $"+(f+parseInt(e.money))+" --- Down!"),x("location","Location: "+d[e.location]),I(),B()},L=function(){for(var e=[],t=0;t<m.stats.resources.length;t++)m.stats.resources[t].amount>0&&e.push(t);return 0!==e.length?!0:!1},T=function(){var t=[];if(m.stats.resources.length>1)for(var o=0;o<m.stats.resources.length;o++)m.stats.resources[o].amount>0&&t.push(o);m.stats.resourceIndex=0===t.length?0:t[e(0,t.length)]},S=function(t){var o=m.stats;"undefined"!=typeof t&&"object"!=typeof t?t<o.resources.length?m.stats.resourceIndex=t:console.error("updateResourceIndex exception: Incoming resourceIndex outside of bounds of resources array."):m.stats.resourceIndex=e(0,o.resources.length)},W=function(e){m.stats.location=e},A=function(e,t,o){var s="";void 0!==e&&null!==e?e.addEventListener("click",function(){"object"==typeof t&&void 0!==t&&null!==t?t.length>1?2===t.length?s=t[0](t[1]):3===t.length&&(s=t[0](t[1],t[2])):s=t():"function"==typeof t?s=t():(console.error("addButtonEvent called with undefined logMessage function. logMessage function should return a string. See syntax: addButtonEvent(button, logFunction, moreBehavior), with moreBehavior being an optional function."),console.error("typeof logMessage = "+typeof t)),void 0!==s&&b(l,s),void 0!==o&&null!==o&&("function"==typeof o?o():"object"==typeof o&&o[0](o[1]))}):console.error("addButtonEvent needs a defined, non-null button as it's first argument. See syntax: addButtonEvent(button, logFunction, moreBehavior), with moreBehavior being an optional function.")},F=function(e,t){"undefined"==typeof e||null===e?(S(),e=m.stats.resourceIndex):S(e);var o=void 0===t?1:t;return m.stats.money<m.stats.resources[e].cost*o?["Can't afford unit(s) of "+m.stats.resources[e].name+".","(Attempted to purchase "+o+".)"]:"You bought "+o+" unit(s) of "+m.stats.resources[e].name+"."},D=function(e){var t=m.stats,o=void 0===e?1:e,s=t.resourceIndex;t.money>=t.resources[s].cost*o?(m.stats.money=t.money-t.resources[s].cost*o,m.stats.resources[s].amount+=parseInt(o)):console.error("buyAction exception: Not enough money to make purchase."),M()},P=function(e,t){if("undefined"==typeof e||null===e){if(!L())return"You don't have any resource to sell! Try buying some.";T(),e=m.stats.resourceIndex}else S(e);var o=void 0===t?1:t;return m.stats.resources[e].amount>=o?"You sold "+o+" unit(s) of "+m.stats.resources[e].name+".":"You don't have "+o+" unit(s) of "+m.stats.resources[e].name+"."},k=function(e){if(L()){var t=m.stats,o=void 0===e?1:e,s=t.resourceIndex;t.resources[s].amount>=o&&(m.stats.resources[s].amount-=parseInt(o),m.stats.money=t.money+t.resources[s].cost*o,M())}},Y=function(){var t=m.stats;if(t.money<u)return"Can't afford to move! Why don't you sell some resources?";S();for(var o=e(d.length);o===t.location;)o=e(d.length);return W(o),["Player moved to "+d[t.location]+", charged $"+u+" to go!"]},O=function(){var e=m.stats;e.money>=u&&(m.stats.money=parseInt(e.money)-u,M())},j=function(){$(".options-text").text("Microstocks"),$(".options-subtext").text("Version 1.0.5"),$(".options-author").html('Author: <a href="https://github.com/evangipson">Evan Gipson</a>'),$(".options").dialog({modal:!0,buttons:{Close:function(){$(this).dialog("close")}}})},H=function(e,t){var o=m.stats,s=e,n=o.resources[s].name,a=o.resources[s].cost,r=o.resources[s].type.name,l=o.resources[s].type.icon,u=o.resources[s].trend.maxFlux,c=o.resources[s].amount,i=u>=0?"<li>Avg. Trend amount: $"+u+"</li>":"<li>Avg. Trend amount: -$"+Math.abs(u)+"</li>",d=c>0?"<li>You own "+c+" unit(s) of "+n+"</li>":"<li>You don't own any units of "+n+"</li>";return'<h3><span class="fa '+l+' fa-fw"></span>'+n+'</h3><hr /><ul><li class="buysell-resource-value">Current cost: $'+a+"</li><li>Type: "+r+"</li>"+i+d+"</ul><hr />"+t},R=function(e){var t=m.stats,o=0,s=0,n=0,a=1,r=t.resources[e].name;$(".buy-sell-dialogue").html(H(e,"Would you like to buy or sell "+r+" today?")),$(".buy-sell").dialog({modal:!0,buttons:{Buy:function(){o=parseInt(t.money)/parseInt(t.resources[e].cost),1>o?$(".buy-sell-dialogue").html(H(e,"Can't afford any "+r+"! Try selling other stock!")):(s=o>=50?5:1,$(".buy-resource-slider").slider({value:1,min:1,max:o,step:s,slide:function(e,t){$(".buy-resource-amount").text("Buying "+t.value+" "+r+"!"),a=t.value}}),n=$(".resource-slider").slider("value"),$(".buy-resource-amount").text("Buying 1 "+r+"!"),$(".buy-dialog").dialog("open"))},Sell:function(){t.resources[e].amount>0?(s=t.resources[e].amount>=50?5:1,$(".sell-resource-slider").slider({value:1,min:1,max:t.resources[e].amount,step:s,slide:function(e,t){$(".sell-resource-amount").text("Selling "+t.value+" "+r+"."),a=t.value}}),n=$(".resource-slider").slider("value"),$(".sell-resource-amount").text("Selling 1 "+r+"."),$(".sell-dialog").dialog("open")):$(".buy-sell-dialogue").html(H(e,"You don't have any "+r+" to sell!"))},Cancel:function(){$(this).dialog("close")}}}),$(".buy-dialog").dialog({autoOpen:!1,modal:!0,buttons:{Buy:function(){if(null!==a&&void 0!==a){var t=F(e,a);b(l,t),D(a)}else console.error("buySellDialogue exception: Resource purchase amount undefined or null, please try again!");$(".buy-sell").dialog("close"),$(this).dialog("close")},Cancel:function(){$(".buy-sell").dialog("close"),$(this).dialog("close")}}}),$(".sell-dialog").dialog({autoOpen:!1,modal:!0,buttons:{Sell:function(){if(null!==a&&void 0!==a){var t=P(e,a);b(l,t),k(a)}else console.error("buySellDialogue exception: Resource sell amount undefined or null, please try again!");$(".buy-sell").dialog("close"),$(this).dialog("close")},Cancel:function(){$(".buy-sell").dialog("close"),$(this).dialog("close")}}})},z=function(e){$(".graph-type").text(e);var t={title:e,hAxis:{title:"Date",titleTextStyle:{color:"#333"},slantedText:!0,slantedTextAngle:30},vAxis:{minValue:0},width:$("#graph-wrapper").outerWidth(),height:$("#graph-wrapper").outerHeight()-50,pointSize:3,isStacked:!1},o=new google.visualization.AreaChart(document.getElementById("graph-wrapper"));o.draw(google.visualization.arrayToDataTable(v[e]),t),$(".graph-dialog").dialog({modal:!0,buttons:{Close:function(){$(this).dialog("close")}}})},K=function(){for(var e=document.getElementsByClassName("resource"),t=0;t<e.length;t++)A(e[t],[R,t])},V=function(){for(var e=m.stats,t="",o="",s=[],n=document.getElementsByClassName("resource-list")[0],a="",r=0;r<e.resources.length;r++){a=document.createElement("LI"),o='<p><span class="fa '+e.resources[r].type.icon+' fa-fw"></span>'+e.resources[r].name+'</p><p><span class="fa fa-dollar fa-fw"></span>'+e.resources[r].cost+"</p>",e.resources[r].amount>0&&(o+='<p><span class="fa fa-shopping-cart fa-fw"></span>'+e.resources[r].amount+"</p>"),a.innerHTML=o,t="resource resource-"+r+" under-hover",e.resources[r].amount>0&&(t+=" owned"),s=t.split(" ");for(var l in s)s.hasOwnProperty(l)&&a.classList.add(s[l]);n.appendChild(a)}K()},q=function(){for(var e=m.stats,t=document.getElementsByClassName("inventory-list")[0],o=0,s=0;s<i.length;s++)o+=e.resources[s].amount*e.resources[s].cost;b(t,"Cash: $"+e.money,"money cash-button"),b(t,"Total Portfolio: $"+o,"money portfolio-button"),b(t,"Net Worth: $"+(o+parseInt(e.money)),"money net-worth-button"),b(t,"Location: "+d[e.location],"location"),V()};return r.init=function(){var e=document.getElementsByClassName("buy-button")[0],t=document.getElementsByClassName("sell-button")[0],o=document.getElementsByClassName("travel-button")[0],s=document.getElementsByClassName("options-button")[0];A(e,F,D),A(t,P,k),A(o,Y,O),A(s,j),q();var n=document.getElementsByClassName("cash-button")[0],a=document.getElementsByClassName("portfolio-button")[0],r=document.getElementsByClassName("net-worth-button")[0];A(n,[z,"cash"]),A(a,[z,"portfolio"]),A(r,[z,"totalMoney"])},r}();$(document).ready(function(){MICROSTOCKS.init()});